<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚˜ë§Œì˜ êµ¬ê¸€ ì‹œíŠ¸ ë‹¨ì–´ì¥</title>
    <style>
        body { font-family: 'Apple SD Gothic Neo', sans-serif; background-color: #f0f2f5; margin: 0; padding: 20px; display: flex; justify-content: center; align-items: center; min-height: 100vh; text-align: center; }
        
        .container { position: relative; background-color: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); width: 100%; max-width: 500px; }
        
        h1 { margin-bottom: 20px; color: #333; margin-top: 10px; }
        .question-box { margin-bottom: 30px; padding: 20px; background-color: #e3f2fd; border-radius: 10px; }
        .eng-text { font-size: 1.4rem; font-weight: bold; color: #1565c0; margin-bottom: 10px; display: block; word-break: keep-all; }
        .lit-text { font-size: 1rem; color: #555; font-style: italic; }
        .answer-box { margin-top: 20px; padding: 20px; background-color: #fff3e0; border-radius: 10px; border: 2px solid #ffe0b2; }
        .trans-text { font-size: 1.2rem; font-weight: bold; color: #e65100; word-break: keep-all; }
        
        button { width: 100%; padding: 15px; margin: 5px 0; border: none; border-radius: 8px; font-size: 1.1rem; cursor: pointer; transition: 0.2s; }
        .btn-show { background-color: #2196F3; color: white; }
        .btn-correct { background-color: #4CAF50; color: white; width: 48%; }
        .btn-wrong { background-color: #f44336; color: white; width: 48%; }
        .btn-note { background-color: #FF9800; color: white; }
        .btn-retry { background-color: #607D8B; color: white; }
        .btn-back { background-color: #9E9E9E; color: white; margin-top: 20px;}
        .hidden { display: none; }
        #wrong-list { text-align: left; list-style: none; padding: 0; }
        #wrong-list li { background: #fff; border-bottom: 1px solid #ddd; padding: 15px; }

        .mode-container { display: flex; flex-direction: column; gap: 15px; width: 100%; }
        .btn-mode { background-color: white; border: 2px solid #e3f2fd; border-radius: 12px; padding: 20px; text-align: left; cursor: pointer; transition: all 0.2s ease; box-shadow: 0 4px 6px rgba(0,0,0,0.05); position: relative; overflow: hidden; }
        .btn-mode:active { transform: scale(0.98); background-color: #f1f8ff; border-color: #2196F3; }
        .btn-mode strong { display: block; font-size: 1.2rem; color: #1565c0; margin-bottom: 5px; }
        .btn-mode span { font-size: 0.9rem; color: #757575; }
        .btn-mode::after { content: 'â”'; position: absolute; right: 20px; top: 50%; transform: translateY(-50%); color: #bbdefb; font-size: 1.5rem; }

        /* ìƒë‹¨ ë²„íŠ¼ ê³µí†µ ìŠ¤íƒ€ì¼ */
        .top-btn {
            position: absolute;
            top: 15px;
            width: auto;
            padding: 5px 10px;
            background: none;
            font-size: 1.5rem;
            color: #757575;
            z-index: 100;
        }
        .top-btn:hover { background-color: #f5f5f5; border-radius: 50%; }
        .btn-home { left: 10px; }
        .btn-finish { right: 10px; font-size: 1.2rem; font-weight: bold; top: 18px; }

    </style>
</head>
<body>
    <div class="container">
        
        <button id="btn-home" class="top-btn btn-home hidden" onclick="goHome()">ğŸ </button>
        <button id="btn-finish" class="top-btn btn-finish hidden" onclick="finishQuizEarly()">ğŸ ì¢…ë£Œ</button>

        <div id="loading-screen" class="hidden">
            <h2>ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</h2>
            <p>êµ¬ê¸€ ì‹œíŠ¸ì™€ ì—°ê²°í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
        </div>

        <div id="start-screen">
            <h1>êµ¬ê¸€ ì‹œíŠ¸ ì˜ë‹¨ì–´ì¥</h1>
            <p style="margin-bottom: 30px;">ê³µë¶€í•  ëª¨ë“œë¥¼ ì„ íƒí•˜ë©´ ë°”ë¡œ ì‹œì‘í•©ë‹ˆë‹¤!</p>
            <div class="mode-container">
                <button class="btn-mode" onclick="initQuiz('recent')">
                    <strong>ğŸ“… ì˜¤ëŠ˜ì˜ ë‹¨ì–´</strong>
                    <span>ìµœê·¼ ì¶”ê°€í•œ 10ê°œë§Œ ì§‘ì¤‘ ê³µëµ</span>
                </button>
                <button class="btn-mode" onclick="initQuiz('random')">
                    <strong>ğŸ² ëœë¤ ë³µìŠµ</strong>
                    <span>ì „ì²´ ë‹¨ì–´ ì¤‘ 10ê°œë¥¼ ë¬´ì‘ìœ„ë¡œ</span>
                </button>
                <button class="btn-mode" onclick="initQuiz('all')">
                    <strong>ğŸ“š ëì¥ ë³´ê¸°</strong>
                    <span>ì²˜ìŒë¶€í„° ëê¹Œì§€ ì „ì²´ ë‹¤ í’€ê¸°</span>
                </button>
            </div>
        </div>

        <div id="quiz-screen" class="hidden">
            <h2 id="progress-text"></h2>
            <div class="question-box">
                <span id="q-eng" class="eng-text"></span>
                <span id="q-lit" class="lit-text"></span>
            </div>
            <button id="btn-show-answer" class="btn-show" onclick="showAnswer()">ì •ë‹µ í™•ì¸</button>
            <div id="answer-area" class="hidden">
                <div class="answer-box"><div id="a-trans" class="trans-text"></div></div>
                <p style="margin-top:15px;">ê²°ê³¼ ì„ íƒ</p>
                <div>
                    <button class="btn-correct" onclick="submitResult(true)">O (ì •ë‹µ)</button>
                    <button class="btn-wrong" onclick="submitResult(false)">X (ì˜¤ë‹µ)</button>
                </div>
            </div>
        </div>

        <div id="result-screen" class="hidden">
            <h1>ê²°ê³¼ í™•ì¸</h1>
            <!-- ì ìˆ˜ê°€ í‘œì‹œë˜ëŠ” ê³³ -->
            <h2 id="score-text" style="font-size: 3rem; color: #2196F3; margin: 10px 0;"></h2>
            <p id="sub-score-text" style="color: #666; margin-bottom: 20px;"></p>
            <p id="feedback-text" style="font-weight: bold;"></p>
            
            <button class="btn-note" onclick="showWrongNote()">ì˜¤ë‹µ ë…¸íŠ¸ ë³´ê¸°</button>
            <button class="btn-retry" onclick="location.reload()">ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
        </div>

        <div id="wrong-note-screen" class="hidden">
            <h1>ì˜¤ë‹µ ë…¸íŠ¸</h1>
            <ul id="wrong-list"></ul>
            <button class="btn-back" onclick="closeWrongNote()">ë‹«ê¸°</button>
        </div>
    </div>

    <script>
        // ============================================================
        // [ì„¤ì •] ë³¸ì¸ì˜ êµ¬ê¸€ ì‹œíŠ¸ ë§í¬ë¥¼ ì—¬ê¸°ì— ë‹¤ì‹œ ë„£ì–´ì£¼ì„¸ìš”!
        // ============================================================
        const GOOGLE_SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRSpGfIs01pu73z_aKvjqdAH0m3UpctkMONg-1HzigUHk-R-nK6wVxewKy35cSg6fIFcRc9S80-V1NY/pub?gid=0&single=true&output=csv"; 
        // ============================================================

        let fullData = [];
        let quizData = [];
        let currentIndex = 0;
        let score = 0;
        let wrongAnswers = [];

        const startScreen = document.getElementById('start-screen');
        const loadingScreen = document.getElementById('loading-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const resultScreen = document.getElementById('result-screen');
        const wrongNoteScreen = document.getElementById('wrong-note-screen');
        const btnHome = document.getElementById('btn-home');
        const btnFinish = document.getElementById('btn-finish');

        async function initQuiz(selectedMode) {
            if(GOOGLE_SHEET_CSV_URL.includes("ì—¬ê¸°ì—_ë³µì‚¬í•œ")) {
                alert("HTML íŒŒì¼ ì½”ë“œë¥¼ ìˆ˜ì •í•´ì„œ êµ¬ê¸€ ì‹œíŠ¸ ë§í¬ë¥¼ ë„£ì–´ì£¼ì„¸ìš”!");
                return;
            }

            startScreen.classList.add('hidden');
            loadingScreen.classList.remove('hidden');

            try {
                const response = await fetch(GOOGLE_SHEET_CSV_URL);
                const dataText = await response.text();
                fullData = parseCSV(dataText);

                if (fullData.length === 0) {
                    alert("ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ìŠ¤í”„ë ˆë“œì‹œíŠ¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.");
                    location.reload();
                    return;
                }

                setupQuizData(selectedMode); 

                loadingScreen.classList.add('hidden');
                quizScreen.classList.remove('hidden');
                btnHome.classList.remove('hidden'); 
                btnFinish.classList.remove('hidden'); 
                
                currentIndex = 0;
                score = 0;
                wrongAnswers = [];
                loadQuestion();

            } catch (error) {
                console.error(error);
                alert("ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                location.reload();
            }
        }

        function goHome() {
            if(!confirm("í€´ì¦ˆë¥¼ ì™„ì „íˆ ì·¨ì†Œí•˜ê³  ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°ˆê¹Œìš”?")) return;
            location.reload();
        }

        function finishQuizEarly() {
            if(currentIndex === 0) {
                alert("ì•„ì§ í‘¼ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤!");
                return;
            }
            if(!confirm("ì§€ê¸ˆê¹Œì§€ í‘¼ ë¬¸ì œë¡œ ì±„ì í•˜ê³  ì¢…ë£Œí• ê¹Œìš”?")) return;
            showResult(); // ê²°ê³¼ í™”ë©´ìœ¼ë¡œ ì´ë™
        }

        function parseCSV(text) {
            const lines = text.trim().split('\n');
            const result = [];
            for (let i = 1; i < lines.length; i++) {
                const row = parseCSVRow(lines[i]);
                if (row.length >= 3) {
                    result.push({
                        eng: row[0].replace(/^"|"$/g, '').trim(),
                        lit: row[1].replace(/^"|"$/g, '').trim(),
                        trans: row[2].replace(/^"|"$/g, '').trim()
                    });
                }
            }
            return result;
        }

        function parseCSVRow(row) {
            let inQuote = false;
            let currentToken = "";
            const result = [];
            for(let i=0; i<row.length; i++) {
                const char = row[i];
                if(char === '"') { inQuote = !inQuote; continue; }
                if(char === ',' && !inQuote) {
                    result.push(currentToken);
                    currentToken = "";
                } else {
                    currentToken += char;
                }
            }
            result.push(currentToken);
            return result;
        }

        function setupQuizData(mode) {
            if (mode === 'recent') {
                quizData = fullData.slice(-10); 
            } else if (mode === 'random') {
                const shuffled = [...fullData].sort(() => 0.5 - Math.random());
                quizData = shuffled.slice(0, 10);
            } else {
                quizData = fullData;
            }
        }

        function loadQuestion() {
            if (currentIndex >= quizData.length) {
                showResult();
                return;
            }
            document.getElementById('btn-show-answer').classList.remove('hidden');
            document.getElementById('answer-area').classList.add('hidden');
            const item = quizData[currentIndex];
            document.getElementById('progress-text').innerText = `ë¬¸ì œ ${currentIndex + 1} / ${quizData.length}`;
            document.getElementById('q-eng').innerText = item.eng;
            document.getElementById('q-lit').innerText = item.lit ? `(ì§ì—­) ${item.lit}` : "";
            document.getElementById('a-trans').innerText = item.trans;
        }

        function showAnswer() {
            document.getElementById('btn-show-answer').classList.add('hidden');
            document.getElementById('answer-area').classList.remove('hidden');
        }

        function submitResult(isCorrect) {
            if (isCorrect) score++;
            else wrongAnswers.push(quizData[currentIndex]);
            currentIndex++;
            loadQuestion();
        }

        // [ìˆ˜ì •ë¨] ì ìˆ˜ ê³„ì‚° ë¡œì§ ë³€ê²½ (100ì  ë§Œì  í™˜ì‚°)
        function showResult() {
            quizScreen.classList.add('hidden');
            resultScreen.classList.remove('hidden');
            btnHome.classList.add('hidden');
            btnFinish.classList.add('hidden');

            // ì‹¤ì œ í‘¼ ë¬¸ì œ ìˆ˜ (currentIndex)
            const totalSolved = currentIndex; 
            
            // ì ìˆ˜ ê³„ì‚° (í‘¼ ë¬¸ì œê°€ 0ê°œë©´ 0ì )
            let finalScore = 0;
            if (totalSolved > 0) {
                finalScore = Math.round((score / totalSolved) * 100);
            }

            // í™”ë©´ í‘œì‹œ
            document.getElementById('score-text').innerText = `${finalScore}ì `;
            document.getElementById('sub-score-text').innerText = `(ì´ ${totalSolved}ë¬¸ì œ ì¤‘ ${score}ê°œ ì •ë‹µ)`;

            // í”¼ë“œë°± í…ìŠ¤íŠ¸
            const feedbackElem = document.getElementById('feedback-text');
            if (finalScore === 100) {
                feedbackElem.innerText = "ì™„ë²½í•´ìš”! ëª¨ë“  ë¬¸ì œë¥¼ ë§ì·„ìŠµë‹ˆë‹¤! ğŸ‰";
                feedbackElem.style.color = "#4CAF50";
            } else if (finalScore >= 80) {
                feedbackElem.innerText = "í›Œë¥­í•´ìš”! ì¡°ê¸ˆë§Œ ë” í•˜ë©´ ë§Œì !";
                feedbackElem.style.color = "#2196F3";
            } else {
                feedbackElem.innerText = "ì˜¤ë‹µ ë…¸íŠ¸ë¥¼ í™•ì¸í•˜ê³  ë‹¤ì‹œ ë„ì „í•´ë³´ì„¸ìš”!";
                feedbackElem.style.color = "#f44336";
            }
        }

        function showWrongNote() {
            if (wrongAnswers.length === 0) return alert("í‹€ë¦° ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤!");
            resultScreen.classList.add('hidden');
            wrongNoteScreen.classList.remove('hidden');
            const list = document.getElementById('wrong-list');
            list.innerHTML = "";
            wrongAnswers.forEach(item => {
                const li = document.createElement('li');
                li.innerHTML = `<div style="font-weight:bold; color:#1565c0;">${item.eng}</div><div style="font-size:0.9rem; color:#666;">${item.lit}</div><div style="font-weight:bold; color:#e65100;">â¥ ${item.trans}</div>`;
                list.appendChild(li);
            });
        }

        function closeWrongNote() {
            wrongNoteScreen.classList.add('hidden');
            resultScreen.classList.remove('hidden');
        }
    </script>
</body>
</html>